{"ast":null,"code":"import React,{useEffect}from'react';import'./Cart.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Cart=_ref=>{let{cartItems,setCartItems,removeFromCart,updateCartItemQuantity,clearCart,showNotification,userProfile,onOrderComplete}=_ref;useEffect(()=>{// Проверка профиля пользователя в localStorage и вывод в консоль\nconst storedUserProfile=localStorage.getItem('userProfile');if(userProfile){console.log('Профиль пользователя загружен:',userProfile);}else if(storedUserProfile){console.log('Профиль пользователя найден в localStorage:',storedUserProfile);}else{console.log('Профиль пользователя не найден');}},[userProfile]);const calculateTotal=()=>{// Рассчитываем общую стоимость товаров в корзине\nreturn cartItems.reduce((total,item)=>total+item.price*item.quantity,0);};const handleCheckout=async()=>{// Если корзина пуста, выводим уведомление\nif(cartItems.length===0){showNotification('Ваша корзина пуста!');return;}const storedUserProfile=localStorage.getItem('userProfile');const storedToken=localStorage.getItem('token');if(!storedUserProfile||!storedToken){showNotification('Вы должны войти в систему для оформления заказа!');return;}const userProfileObj=JSON.parse(storedUserProfile);if(!userProfileObj||!userProfileObj._id){showNotification('Профиль пользователя некорректен');return;}const newOrder={items:cartItems.map(item=>({productId:item.id,name:item.name,price:item.price,quantity:item.quantity})),total:calculateTotal()};try{const response=await fetch('http://localhost:5000/api/orders',{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${storedToken}`},body:JSON.stringify(newOrder)});if(!response.ok){const error=await response.json();showNotification(error.message||'Ошибка при оформлении заказа');return;}const data=await response.json();if(typeof onOrderComplete==='function'){onOrderComplete(data.order);}else{console.error('onOrderComplete не является функцией');}clearCart();showNotification('Заказ успешно оформлен!');}catch(error){console.error('Ошибка при оформлении заказа:',error.message);showNotification(error.message||'Ошибка при оформлении заказа');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"cart-details\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0421\\u043E\\u0434\\u0435\\u0440\\u0436\\u0438\\u043C\\u043E\\u0435 \\u043A\\u043E\\u0440\\u0437\\u0438\\u043D\\u044B\"}),cartItems.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"\\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430 \\u043F\\u0443\\u0441\\u0442\\u0430\"}):/*#__PURE__*/_jsx(\"ul\",{children:cartItems.map(item=>/*#__PURE__*/_jsxs(\"li\",{className:\"cart-item\",children:[/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:item.name,width:\"50\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-details\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[item.name,\" \\u2014 \",item.price,\" \\u20BD, \\u0440\\u0430\\u0437\\u043C\\u0435\\u0440: \",item.size]}),/*#__PURE__*/_jsxs(\"div\",{className:\"quantity-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>updateCartItemQuantity(item.id,-1)// Уменьшаем количество товара\n,className:\"quantity-button\",children:\"-\"}),/*#__PURE__*/_jsx(\"span\",{children:item.quantity}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>updateCartItemQuantity(item.id,1)// Увеличиваем количество товара\n,className:\"quantity-button\",children:\"+\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeFromCart(item.id)// Удаляем товар из корзины\n,className:\"remove-button\",children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"})]},`${item.id}-${item.size}`))}),cartItems.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"total\",children:[/*#__PURE__*/_jsxs(\"h4\",{children:[\"\\u0418\\u0442\\u043E\\u0433\\u043E\\u0432\\u0430\\u044F \\u0441\\u0442\\u043E\\u0438\\u043C\\u043E\\u0441\\u0442\\u044C: \",calculateTotal(),\" \\u20BD\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCheckout,className:\"checkout-button\",children:\"\\u041E\\u0444\\u043E\\u0440\\u043C\\u0438\\u0442\\u044C \\u0437\\u0430\\u043A\\u0430\\u0437\"})]})]});};export default Cart;","map":{"version":3,"names":["React","useEffect","jsx","_jsx","jsxs","_jsxs","Cart","_ref","cartItems","setCartItems","removeFromCart","updateCartItemQuantity","clearCart","showNotification","userProfile","onOrderComplete","storedUserProfile","localStorage","getItem","console","log","calculateTotal","reduce","total","item","price","quantity","handleCheckout","length","storedToken","userProfileObj","JSON","parse","_id","newOrder","items","map","productId","id","name","response","fetch","method","headers","Authorization","body","stringify","ok","error","json","message","data","order","className","children","src","image","alt","width","size","onClick"],"sources":["C:/Users/79818/shop1/src/components/Cart.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport './Cart.css';\r\n\r\nconst Cart = ({\r\n  cartItems,\r\n  setCartItems,\r\n  removeFromCart,\r\n  updateCartItemQuantity,\r\n  clearCart,\r\n  showNotification,\r\n  userProfile,\r\n  onOrderComplete,\r\n}) => {\r\n  useEffect(() => {\r\n    // Проверка профиля пользователя в localStorage и вывод в консоль\r\n    const storedUserProfile = localStorage.getItem('userProfile');\r\n    if (userProfile) {\r\n      console.log('Профиль пользователя загружен:', userProfile);\r\n    } else if (storedUserProfile) {\r\n      console.log('Профиль пользователя найден в localStorage:', storedUserProfile);\r\n    } else {\r\n      console.log('Профиль пользователя не найден');\r\n    }\r\n  }, [userProfile]);\r\n\r\n  const calculateTotal = () => {\r\n    // Рассчитываем общую стоимость товаров в корзине\r\n    return cartItems.reduce((total, item) => total + item.price * item.quantity, 0);\r\n  };\r\n\r\n  const handleCheckout = async () => {\r\n    // Если корзина пуста, выводим уведомление\r\n    if (cartItems.length === 0) {\r\n      showNotification('Ваша корзина пуста!');\r\n      return;\r\n    }\r\n\r\n    const storedUserProfile = localStorage.getItem('userProfile');\r\n    const storedToken = localStorage.getItem('token');\r\n\r\n    if (!storedUserProfile || !storedToken) {\r\n      showNotification('Вы должны войти в систему для оформления заказа!');\r\n      return;\r\n    }\r\n\r\n    const userProfileObj = JSON.parse(storedUserProfile);\r\n\r\n    if (!userProfileObj || !userProfileObj._id) {\r\n      showNotification('Профиль пользователя некорректен');\r\n      return;\r\n    }\r\n\r\n    const newOrder = {\r\n      items: cartItems.map((item) => ({\r\n        productId: item.id,\r\n        name: item.name,\r\n        price: item.price,\r\n        quantity: item.quantity,\r\n      })),\r\n      total: calculateTotal(),\r\n    };\r\n\r\n    try {\r\n      const response = await fetch('http://localhost:5000/api/orders', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${storedToken}`,\r\n        },\r\n        body: JSON.stringify(newOrder),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json();\r\n        showNotification(error.message || 'Ошибка при оформлении заказа');\r\n        return;\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      if (typeof onOrderComplete === 'function') {\r\n        onOrderComplete(data.order);\r\n      } else {\r\n        console.error('onOrderComplete не является функцией');\r\n      }\r\n\r\n      clearCart();\r\n      showNotification('Заказ успешно оформлен!');\r\n    } catch (error) {\r\n      console.error('Ошибка при оформлении заказа:', error.message);\r\n      showNotification(error.message || 'Ошибка при оформлении заказа');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"cart-details\">\r\n      <h3>Содержимое корзины</h3>\r\n      {cartItems.length === 0 ? (\r\n        <p>Корзина пуста</p>\r\n      ) : (\r\n        <ul>\r\n          {cartItems.map((item) => (\r\n            <li key={`${item.id}-${item.size}`} className=\"cart-item\">\r\n              <img src={item.image} alt={item.name} width=\"50\" />\r\n              <div className=\"item-details\">\r\n                <span>\r\n                  {item.name} — {item.price} ₽, размер: {item.size}\r\n                </span>\r\n                <div className=\"quantity-controls\">\r\n                  <button\r\n                    onClick={() => updateCartItemQuantity(item.id, -1)}  // Уменьшаем количество товара\r\n                    className=\"quantity-button\"\r\n                  >\r\n                    -\r\n                  </button>\r\n                  <span>{item.quantity}</span>\r\n                  <button\r\n                    onClick={() => updateCartItemQuantity(item.id, 1)}  // Увеличиваем количество товара\r\n                    className=\"quantity-button\"\r\n                  >\r\n                    +\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={() => removeFromCart(item.id)}  // Удаляем товар из корзины\r\n                className=\"remove-button\"\r\n              >\r\n                Удалить\r\n              </button>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      )}\r\n      {cartItems.length > 0 && (\r\n        <div className=\"total\">\r\n          <h4>Итоговая стоимость: {calculateTotal()} ₽</h4>\r\n          <button onClick={handleCheckout} className=\"checkout-button\">\r\n            Оформить заказ\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Cart;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}